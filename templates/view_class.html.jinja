<!-- filepath: c:\Users\Snvok\data\hombreeeeee\templates\view_class.html.jinja -->
{% extends "base.html.jinja" %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/view-pages.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/comments.css') }}">
{% endblock %}

{% block title %}{{ current_class.name }}{% endblock %}
{% block content %}
<div class="race-section">
    <div class="race-info">
        <h1>{{ current_class.name }}</h1>
        <p>{{ current_class.description | nl2br }}</p>

        <div class="class-characteristics">
            <h2>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–ª–∞—Å—Å–∞</h2>
            <div class="characteristics-grid">
                <div class="char-item">
                    <strong>–ö–æ—Å—Ç—å —Ö–∏—Ç–æ–≤:</strong> {{ current_class.hit_dice }}
                </div>
                <div class="char-item">
                    <strong>–•–∏—Ç—ã –Ω–∞ 1 —É—Ä–æ–≤–Ω–µ:</strong> {{ current_class.hit_points_first }}
                </div>
                <div class="char-item">
                    <strong>–•–∏—Ç—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–≤–Ω—è—Ö:</strong> {{ current_class.hit_points_next }}
                </div>
                <div class="char-item">
                    <strong>–í–ª–∞–¥–µ–Ω–∏–µ –¥–æ—Å–ø–µ—Ö–∞–º–∏:</strong> {{ current_class.armor_proficiencies }}
                </div>
                <div class="char-item">
                    <strong>–í–ª–∞–¥–µ–Ω–∏–µ –æ—Ä—É–∂–∏–µ–º:</strong> {{ current_class.weapon_proficiencies }}
                </div>
                <div class="char-item">
                    <strong>–í–ª–∞–¥–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:</strong> {{ current_class.tool_proficiencies }}
                </div>
                <div class="char-item">
                    <strong>–°–ø–∞—Å–±—Ä–æ—Å–∫–∏:</strong> {{ current_class.saving_throws }}
                </div>
                <div class="char-item">
                    <strong>–ù–∞–≤—ã–∫–∏:</strong> {{ current_class.skills }}
                </div>
            </div>
        </div>

        <div class="class-table-section">
            <h2>–¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–≤–∏—Ç–∏—è –∫–ª–∞—Å—Å–∞</h2>
            <div class="table-wrapper">
                <table class="class-table">
                    <thead>
                        <tr>
                            <th>–£—Ä–æ–≤–µ–Ω—å</th>
                            <th>–ë–æ–Ω—É—Å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</th>
                            {% for col in custom_columns %}
                                <th>{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in class_table %}
                        <tr>
                            <td>{{ row.level }}</td>
                            <td>+{{ row.proficiency_bonus }}</td>
                            {% for col in custom_columns %}
                                <td>{{ row.custom.get(col, '') }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="abilities-section">
            <h2>–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–∞</h2>
            {% for ability in abilities %}
                <div class="ability-card">
                    <h3>{{ ability.name }} <span class="ability-level">({{ ability.level }} —É—Ä–æ–≤–µ–Ω—å)</span></h3>
                    <p>{{ ability.description | nl2br }}</p>
                </div>
            {% endfor %}
        </div>
        
        {% if user and (user.id == current_class.user_id or user.id in (current_class.editors_allowed or [])) %}
            <div class="action-buttons">
                <a href="{{ url_for('classes.edit_class', class_id=current_class.id) }}" class="edit-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å</a>
                <a href="{{ url_for('main.grant_edit', content_type='class', content_id=current_class.id) }}" class="manage-btn">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏</a>
                {% if user.id == current_class.user_id %}
                    <button type="button" class="delete-btn" onclick="confirmDelete('{{ url_for('classes.delete_class', class_id=current_class.id) }}', '{{ current_class.name }}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å</button>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <div class="comments-section">
        <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
        {% if current_class.comments %}
            <ul class="comments-list">
                {% for comment in current_class.comments %}
                    <li class="comment-item">
                        <div class="comment-header">
                            <strong>{{ comment.author.username if comment.author else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω' }}</strong>
                            {% if comment.timestamp %}
                                <span class="comment-date">({{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }})</span>
                            {% endif %}
                        </div>
                        <div class="comment-body">{{ comment.text | nl2br }}</div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="no-comments">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
        {% endif %}
        
        {% if user %}
            <div class="comment-form">
                <form method="POST" action="{{ url_for('classes.add_class_comment', class_id=current_class.id) }}">
                    {{ comment_form.csrf_token }}
                    <div class="comment-form-fields">
                        {{ comment_form.text(rows=4, class="form-control", placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏ –æ–± —ç—Ç–æ–º –∫–ª–∞—Å—Å–µ...") }}
                        {% for error in comment_form.text.errors %}
                            <span class="form-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="comment-form-actions">
                        {{ comment_form.submit(class="comment-submit-btn") }}
                    </div>
                </form>
            </div>
        {% else %}
            <div class="login-prompt">
                <p>–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="{{ url_for('auth.login') }}">–≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</a></p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}