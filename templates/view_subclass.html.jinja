{% extends "base.html.jinja" %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/view-pages.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/comments.css') }}">
{% endblock %}

{% block title %}{{ current_subclass.name }}{% endblock %}

{% block content %}
<div class="race-section">
    <div class="race-info">
        <h1>{{ current_subclass.name }}</h1>
        <div class="subclass-parent">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ö–ª–∞—Å—Å: <a href="{{ url_for('classes.view_class', class_id=current_subclass.class_id) }}">{{ current_subclass.parent_class.name }}</a></div>
        <p>{{ current_subclass.description | nl2br }}</p>

        <div class="abilities-section">
            <h2>–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º</h2>
            {% if abilities %}
                <div class="table-wrapper">
                    <table class="class-table">
                        <thead>
                            <tr>
                                <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–¢–∏–ø</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ab in abilities %}
                                <tr>
                                    <td>{{ ab.level }}</td>
                                    <td>{{ ab.name }}</td>
                                    <td>{{ ab.type }}</td>
                                    <td>{{ ab.description | nl2br }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-abilities">
                    <p>–î–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥–∫–ª–∞—Å—Å–∞ –ø–æ–∫–∞ –Ω–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.</p>
                </div>
            {% endif %}
        </div>

        {% if g.user and can_edit %}
            <div class="action-buttons">
                <a href="{{ url_for('subclasses.edit_subclass', subclass_id=current_subclass.id) }}" class="edit-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª–∞—Å—Å</a>
                <a href="{{ url_for('main.grant_edit', content_type='subclass', content_id=current_subclass.id) }}" class="edit-btn">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏</a>
                <form action="{{ url_for('subclasses.delete_subclass', subclass_id=current_subclass.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ–¥–∫–ª–∞—Å—Å?');">
                    <input type="submit" value="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å" class="edit-btn delete-button">
                </form>
            </div>
        {% endif %}
    </div>

    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h3>
    {% if current_subclass.comments %}
        <ul>
            {% for comment in current_subclass.comments %}
                <li>
                    <strong>{{ comment.author.username if comment.author else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω' }}</strong>
                    {% if comment.timestamp %}
                        ({{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }})
                    {% endif %}:
                    <p>{{ comment.text | nl2br }}</p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
    {% endif %}

    {% if g.user %}
        {% if user %}
            <div class="comment-form">
                <form method="POST" action="{{ url_for('subclasses.add_subclass_comment', subclass_id=current_subclass.id) }}">
                    {{ comment_form.csrf_token }}
                    <div class="comment-form-fields">
                        {{ comment_form.text(class="form-control", rows=4, placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏ –æ–± —ç—Ç–æ–º –ø–æ–¥–∫–ª–∞—Å—Å–µ...") }}
                        {% for error in comment_form.text.errors %}
                            <span class="form-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="comment-form-actions">
                        {{ comment_form.submit(class="comment-submit-btn") }}
                    </div>
                </form>
            </div>
        {% else %}
            <div class="login-prompt">
                <p>–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="{{ url_for('auth.login') }}">–≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</a></p>
            </div>
        {% endif %}
    {% endif %}
{% endblock %}